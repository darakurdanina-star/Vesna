<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ü–æ—Å–∞–¥–∏ —Å–µ–º–µ–Ω–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            touch-action: none;
            background-color: #2c3e50;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* –ò–ì–†–û–í–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† - –ö–ê–ö –í –ö–û–õ–û–ë–ö–ï */
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh; /* –ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
            background-color: #4CAF50;
            overflow: hidden;
            margin: auto;
        }

        /* –§–û–ù - –†–ê–°–¢–Ø–ì–ò–í–ê–ï–¢–°–Ø –ù–ê –í–ï–°–¨ –≠–ö–†–ê–ù */
        .background-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('fon.png');
            background-size: cover; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }

        /* –ö–ê–†–¢–ê –ü–û–°–ê–î–ö–ò */
        .map-container {
            position: absolute;
            top: 2%;
            right: 2%;
            width: min(200px, 25%);
            aspect-ratio: 1/1;
            border: 4px solid white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            z-index: 10;
            background: white;
            pointer-events: none;
        }

        .map-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* –õ–£–ù–ö–ò (–Ω–µ–≤–∏–¥–∏–º—ã–µ –∑–æ–Ω—ã) - –ö–û–û–†–î–ò–ù–ê–¢–´ –í –ü–†–û–¶–ï–ù–¢–ê–• */
        .hole-zone {
            position: absolute;
            width: 10%;  /* –†–∞–∑–º–µ—Ä –∑–æ–Ω—ã */
            height: 10%;
            transform: translate(-50%, -50%);
            z-index: 5;
            /* border: 2px dashed red; /* –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ */
        }

        /* –°–ï–ú–ï–ù–ê */
        .seed {
            position: absolute;
            width: 8%;
            max-width: 80px;
            height: auto;
            cursor: grab;
            touch-action: none;
            user-select: none;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
            z-index: 20;
            transition: filter 0.2s;
            transform: translate(0, 0); /* –í–∞–∂–Ω–æ –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
        }

        .seed:active {
            cursor: grabbing;
            filter: drop-shadow(0 8px 6px rgba(0,0,0,0.5));
        }

        .seed.dragging {
            transition: none;
        }

        .seed.placed {
            cursor: default;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
            pointer-events: none;
        }

        /* –°–¢–ê–†–¢–û–í–´–ï –ü–û–ó–ò–¶–ò–ò –°–ï–ú–Ø–ù (–≤–Ω–∏–∑—É) */
        #seed-red { left: 10%; top: 90%; }
        #seed-orange { left: 25%; top: 90%; }
        #seed-brown { left: 40%; top: 90%; }
        #seed-purple { left: 55%; top: 90%; }
        #seed-beige { left: 70%; top: 90%; }
        #seed-green { left: 85%; top: 90%; }

        /* –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê */
        #result-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .result-img {
            width: min(500px, 80%);
            border: 5px solid white;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .next-button {
            padding: min(15px, 2vh) min(40px, 5vw);
            font-size: min(28px, 4vh);
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #2E7D32;
            font-weight: bold;
        }

        .next-button:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #2E7D32;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- –§–û–ù -->
        <div class="background-layer"></div>

        <!-- –ö–ê–†–¢–ê –ü–û–°–ê–î–ö–ò -->
        <div class="map-container">
            <img src="map.png" alt="–ö–∞—Ä—Ç–∞ –ø–æ—Å–∞–¥–∫–∏" class="map-img">
        </div>

        <!-- –õ–£–ù–ö–ò (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö) -->
        <div class="hole-zone" id="hole-1" style="left: 27%; top: 83.3%;" data-seed="red"></div>
        <div class="hole-zone" id="hole-2" style="left: 48.5%; top: 83.3%;" data-seed="brown"></div>
        <div class="hole-zone" id="hole-3" style="left: 68.8%; top: 83.3%;" data-seed="beige"></div>
        <div class="hole-zone" id="hole-4" style="left: 34.8%; top: 66.8%;" data-seed="orange"></div>
        <div class="hole-zone" id="hole-5" style="left: 48.5%; top: 66.8%;" data-seed="purple"></div>
        <div class="hole-zone" id="hole-6" style="left: 62.2%; top: 66.8%;" data-seed="green"></div>

        <!-- –°–ï–ú–ï–ù–ê -->
        <img src="red.png" class="seed" id="seed-red" data-color="red">
        <img src="orange.png" class="seed" id="seed-orange" data-color="orange">
        <img src="brown.png" class="seed" id="seed-brown" data-color="brown">
        <img src="purple.png" class="seed" id="seed-purple" data-color="purple">
        <img src="beige.png" class="seed" id="seed-beige" data-color="beige">
        <img src="green.png" class="seed" id="seed-green" data-color="green">

        <!-- –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê -->
        <div id="result-screen">
            <img src="result.png" alt="–£—Ä–æ–∂–∞–π –≤—ã—Ä–æ—Å!" class="result-img">
            <button class="next-button" onclick="goToHarvest()">üå± –ù–ê –°–ë–û–† –£–†–û–ñ–ê–Ø üå±</button>
        </div>
    </div>

    <script>
        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        
        const seeds = document.querySelectorAll('.seed');
        const holes = document.querySelectorAll('.hole-zone');
        const resultScreen = document.getElementById('result-screen');
        const container = document.getElementById('game-container');

        const filledHoles = new Array(holes.length).fill(false);
        
        let isDragging = false;
        let currentSeed = null;
        let startX, startY, startLeft, startTop;
        let audioContext = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        function playSound(type) {
            try {
                initAudio();
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.connect(gain);
                gain.connect(audioContext.destination);

                if (type === 'correct') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(600, audioContext.currentTime);
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    osc.start();
                    osc.stop(audioContext.currentTime + 0.2);
                } else {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(200, audioContext.currentTime);
                    gain.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    osc.start();
                    osc.stop(audioContext.currentTime + 0.15);
                }
            } catch (e) {}
        }

        // ========== –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï ==========
        
        function onDragStart(e) {
            if (e.target.classList.contains('placed')) return;
            if (resultScreen.style.display === 'flex') return;
            
            e.preventDefault();
            initAudio();
            
            currentSeed = e.target;
            isDragging = true;
            currentSeed.classList.add('dragging');
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const rect = currentSeed.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            startX = clientX - rect.left;
            startY = clientY - rect.top;
            
            startLeft = rect.left - containerRect.left;
            startTop = rect.top - containerRect.top;
            
            currentSeed.style.left = startLeft + 'px';
            currentSeed.style.top = startTop + 'px';
        }

        function onDragMove(e) {
            if (!isDragging || !currentSeed) return;
            e.preventDefault();
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const containerRect = container.getBoundingClientRect();
            
            let newLeft = clientX - startX - containerRect.left;
            let newTop = clientY - startY - containerRect.top;
            
            const seedWidth = currentSeed.offsetWidth;
            const seedHeight = currentSeed.offsetHeight;
            
            newLeft = Math.max(0, Math.min(newLeft, containerRect.width - seedWidth));
            newTop = Math.max(0, Math.min(newTop, containerRect.height - seedHeight));
            
            currentSeed.style.left = newLeft + 'px';
            currentSeed.style.top = newTop + 'px';
        }

        function onDragEnd(e) {
            if (!isDragging || !currentSeed) return;
            e.preventDefault();
            
            isDragging = false;
            currentSeed.classList.remove('dragging');
            
            checkDrop(currentSeed);
            currentSeed = null;
        }

        // ========== –ü–†–û–í–ï–†–ö–ê ==========
        
        function checkDrop(seed) {
            const seedRect = seed.getBoundingClientRect();
            const seedCenterX = seedRect.left + seedRect.width / 2;
            const seedCenterY = seedRect.top + seedRect.height / 2;
            
            const seedColor = seed.dataset.color;
            
            for (let i = 0; i < holes.length; i++) {
                const hole = holes[i];
                const holeRect = hole.getBoundingClientRect();
                
                if (seedCenterX >= holeRect.left && seedCenterX <= holeRect.right &&
                    seedCenterY >= holeRect.top && seedCenterY <= holeRect.bottom) {
                    
                    const requiredColor = hole.dataset.seed;
                    
                    if (seedColor === requiredColor && !filledHoles[i]) {
                        plantSeed(seed, hole, i);
                        playSound('correct');
                    } else {
                        playSound('error');
                        returnSeedToStart(seed);
                        container.classList.add('shake');
                        setTimeout(() => container.classList.remove('shake'), 400);
                    }
                    return;
                }
            }
            
            returnSeedToStart(seed);
        }

        function plantSeed(seed, hole, holeIndex) {
            filledHoles[holeIndex] = true;
            seed.classList.add('placed');
            
            const holeRect = hole.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const targetLeft = holeRect.left - containerRect.left + (holeRect.width / 2) - (seed.offsetWidth / 2);
            const targetTop = holeRect.top - containerRect.top + (holeRect.height / 2) - (seed.offsetHeight / 2);
            
            seed.style.left = targetLeft + 'px';
            seed.style.top = targetTop + 'px';
            
            checkAllPlanted();
        }

        function returnSeedToStart(seed) {
            switch(seed.dataset.color) {
                case 'red': seed.style.left = '10%'; seed.style.top = '90%'; break;
                case 'orange': seed.style.left = '25%'; seed.style.top = '90%'; break;
                case 'brown': seed.style.left = '40%'; seed.style.top = '90%'; break;
                case 'purple': seed.style.left = '55%'; seed.style.top = '90%'; break;
                case 'beige': seed.style.left = '70%'; seed.style.top = '90%'; break;
                case 'green': seed.style.left = '85%'; seed.style.top = '90%'; break;
            }
        }

        function checkAllPlanted() {
            const allPlanted = Array.from(seeds).every(seed => seed.classList.contains('placed'));
            
            if (allPlanted) {
                setTimeout(() => {
                    resultScreen.style.display = 'flex';
                }, 500);
            }
        }

        function goToHarvest() {
            alert('–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–±–æ—Ä —É—Ä–æ–∂–∞—è!');
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—Ç–æ—Ä–æ–π —ç–∫—Ä–∞–Ω
        }

        // ========== –°–û–ë–´–¢–ò–Ø ==========
        
        seeds.forEach(seed => {
            seed.addEventListener('mousedown', onDragStart);
            seed.addEventListener('touchstart', onDragStart, { passive: false });
        });

        window.addEventListener('mousemove', onDragMove);
        window.addEventListener('touchmove', onDragMove, { passive: false });

        window.addEventListener('mouseup', onDragEnd);
        window.addEventListener('touchend', onDragEnd);

        // –ó–∞–ø—Ä–µ—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
        document.addEventListener('selectstart', (e) => e.preventDefault());

    </script>
</body>
</html>
