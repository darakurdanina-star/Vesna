<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–û–≥–æ—Ä–æ–¥: –ø–æ—Å–∞–¥–∏ –∏ —Å–æ–±–µ—Ä–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            touch-action: none;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* –ò–ì–†–û–í–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
        #game-container {
            position: relative;
            width: 100vw;
            height: 57.14vw; /* 768/1344 = 0.5714 */
            max-width: 1344px;
            max-height: 768px;
            background-color: #4CAF50;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            margin: auto;
        }

        /* –§–û–ù */
        .background-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('fon.png');
            background-size: cover;
            background-position: center;
            z-index: 1;
        }

        /* –ö–ê–†–¢–ê –ü–û–°–ê–î–ö–ò */
        .map-container {
            position: absolute;
            top: 2%;
            right: 2%;
            width: 20%;
            max-width: 180px;
            aspect-ratio: 1/1;
            border: 4px solid white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            z-index: 10;
            background: white;
            pointer-events: none;
        }

        .map-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* –õ–£–ù–ö–ò (–Ω–µ–≤–∏–¥–∏–º—ã–µ –∑–æ–Ω—ã) */
        .hole-zone {
            position: absolute;
            width: 12%;
            height: 12%;
            transform: translate(-50%, -50%);
            z-index: 5;
            /* border: 2px dashed red; */
        }

        /* –°–ï–ú–ï–ù–ê - –í–°–ï –û–î–ò–ù–ê–ö–û–í–û–ì–û –†–ê–ó–ú–ï–†–ê */
        .seed {
            position: absolute;
            width: 8%;
            height: auto;
            cursor: grab;
            touch-action: none;
            user-select: none;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
            z-index: 20;
            transition: filter 0.2s;
            pointer-events: auto;
        }

        .seed:active {
            cursor: grabbing;
            filter: drop-shadow(0 8px 6px rgba(0,0,0,0.5));
        }

        .seed.dragging {
            transition: none;
        }

        .seed.placed {
            cursor: default;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
            pointer-events: none;
        }

        /* –ö–û–†–ó–ò–ù–ö–ò - –û–ß–ï–ù–¨ –ö–†–£–ü–ù–´–ï */
        .basket {
            position: absolute;
            width: 15%;
            height: auto;
            z-index: 15;
            pointer-events: none;
            filter: drop-shadow(0 8px 8px rgba(0,0,0,0.5));
        }

        /* –û–í–û–©–ò */
        .vegetable {
            position: absolute;
            width: 9%;
            height: auto;
            cursor: grab;
            touch-action: none;
            user-select: none;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
            z-index: 20;
            transition: filter 0.2s;
            transform: translate(-50%, -50%);
        }

        .vegetable:active {
            cursor: grabbing;
            filter: drop-shadow(0 8px 6px rgba(0,0,0,0.5));
        }

        .vegetable.dragging {
            transition: none;
        }

        .vegetable.placed {
            cursor: default;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
            pointer-events: none;
        }

        /* –ü–û–ó–ò–¶–ò–ò –°–ï–ú–Ø–ù (–ù–ê–í–ï–†–•–£) */
        #seed-red { left: 4%; top: 3%; width: 8%; }
        #seed-orange { left: 14%; top: 3%; width: 8%; }
        #seed-brown { left: 24%; top: 3%; width: 8%; }
        #seed-purple { left: 34%; top: 3%; width: 8%; }
        #seed-beige { left: 44%; top: 3%; width: 8%; }
        #seed-green { left: 54%; top: 3%; width: 8%; }

        /* –ü–û–ó–ò–¶–ò–ò –ö–û–†–ó–ò–ù–û–ö - –†–ê–í–ù–û–ú–ï–†–ù–û –ü–û –®–ò–†–ò–ù–ï */
        #basket-red { left: 8%; top: 12%; width: 15%; }
        #basket-orange { left: 25%; top: 12%; width: 15%; }
        #basket-brown { left: 42%; top: 12%; width: 15%; }
        #basket-purple { left: 59%; top: 12%; width: 15%; }
        #basket-beige { left: 76%; top: 12%; width: 15%; }
        #basket-green { left: 93%; top: 12%; width: 15%; transform: translateX(-50%); }

        /* –ù–ï–í–ò–î–ò–ú–´–ï –ó–û–ù–´ –î–õ–Ø –ö–û–†–ó–ò–ù–û–ö (–¥–ª—è –æ—Ç–ª–æ–≤–∞ –∫–∞—Å–∞–Ω–∏–π) */
        .basket-zone {
            position: absolute;
            width: 18%;  /* –ë–æ–ª—å—à–µ —Å–∞–º–æ–π –∫–æ—Ä–∑–∏–Ω–∫–∏ */
            height: 18%;
            transform: translate(-50%, -50%);
            z-index: 16;
            pointer-events: auto;
            /* border: 2px solid blue; /* –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ */
        }

        /* –≠–ö–†–ê–ù–´ */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        #screen-plant {
            display: block;
        }

        #screen-harvest {
            display: none;
        }

        /* –ö–ù–û–ü–ö–ê –ü–ï–†–ï–•–û–î–ê */
        .next-button {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 30px;
            font-size: 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #2E7D32;
            font-weight: bold;
            z-index: 30;
            border: 2px solid #FFD700;
        }

        .next-button:active {
            transform: translateX(-50%) translateY(4px);
            box-shadow: 0 1px 0 #2E7D32;
        }

        .next-button.hidden {
            display: none;
        }

      /* –≠–ö–†–ê–ù –ü–û–ë–ï–î–´ */
#win-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 200;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(8px);
}

.win-message {
    background: #FFD700;
    padding: 20px 30px;        /* –ë—ã–ª–æ 30px 40px */
    border-radius: 40px;        /* –ë—ã–ª–æ 60px */
    border: 4px solid white;     /* –ë—ã–ª–æ 6px */
    text-align: center;
    box-shadow: 0 10px 0 #B8860B; /* –ë—ã–ª–æ 15px */
    margin-bottom: 20px;         /* –ë—ã–ª–æ 30px */
}

.win-message h2 {
    font-size: 28px;            /* –ë—ã–ª–æ 36px */
    color: #2E5E2E;
    text-shadow: 2px 2px 0 white;
    margin-bottom: 5px;          /* –ë—ã–ª–æ 10px */
}

.win-message p {
    font-size: 18px;            /* –ë—ã–ª–æ 24px */
    color: #4B2E1E;
    font-weight: bold;
}

.win-message p:last-of-type {   /* –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ "–°—ã–≥—Ä–∞–µ–º –µ—â—ë?" */
    font-size: 16px !important;  /* –£–º–µ–Ω—å—à–∞–µ—Ç –≤—Ç–æ—Ä–æ–π –∞–±–∑–∞—Ü */
    margin-top: 10px !important;
}

.win-button {
    padding: 12px 35px;         /* –ë—ã–ª–æ 18px 50px */
    font-size: 24px;            /* –ë—ã–ª–æ 32px */
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 40px;        /* –ë—ã–ª–æ 60px */
    cursor: pointer;
    box-shadow: 0 6px 0 #2E7D32; /* –ë—ã–ª–æ 8px */
    font-weight: bold;
    border: 3px solid #FFD700;
    transition: 0.1s;
}

        .win-button:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #2E7D32;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- –§–û–ù -->
        <div class="background-layer"></div>

        <!-- ========== –≠–ö–†–ê–ù 1: –ü–û–°–ê–î–ö–ê ========== -->
        <div id="screen-plant" class="screen">
            <!-- –ö–ê–†–¢–ê –ü–û–°–ê–î–ö–ò -->
            <div class="map-container">
                <img src="map.png" alt="–ö–∞—Ä—Ç–∞ –ø–æ—Å–∞–¥–∫–∏" class="map-img">
            </div>

            <!-- –õ–£–ù–ö–ò -->
            <div class="hole-zone" id="hole-1" style="left: 27%; top: 83.3%;" data-seed="red" data-screen="plant"></div>
            <div class="hole-zone" id="hole-2" style="left: 48.5%; top: 83.3%;" data-seed="brown" data-screen="plant"></div>
            <div class="hole-zone" id="hole-3" style="left: 68.8%; top: 83.3%;" data-seed="beige" data-screen="plant"></div>
            <div class="hole-zone" id="hole-4" style="left: 34.8%; top: 66.8%;" data-seed="orange" data-screen="plant"></div>
            <div class="hole-zone" id="hole-5" style="left: 48.5%; top: 66.8%;" data-seed="purple" data-screen="plant"></div>
            <div class="hole-zone" id="hole-6" style="left: 62.2%; top: 66.8%;" data-seed="green" data-screen="plant"></div>

            <!-- –°–ï–ú–ï–ù–ê -->
            <img src="red.png" class="seed" id="seed-red" data-color="red" data-screen="plant">
            <img src="orange.png" class="seed" id="seed-orange" data-color="orange" data-screen="plant">
            <img src="brown.png" class="seed" id="seed-brown" data-color="brown" data-screen="plant">
            <img src="purple.png" class="seed" id="seed-purple" data-color="purple" data-screen="plant">
            <img src="beige.png" class="seed" id="seed-beige" data-color="beige" data-screen="plant">
            <img src="green.png" class="seed" id="seed-green" data-color="green" data-screen="plant">

            <!-- –ö–ù–û–ü–ö–ê –ü–ï–†–ï–•–û–î–ê -->
            <button class="next-button hidden" id="to-harvest-btn" onclick="switchToHarvest()">üå± –ù–ê –°–ë–û–† –£–†–û–ñ–ê–Ø üå±</button>
        </div>

        <!-- ========== –≠–ö–†–ê–ù 2: –°–ë–û–† –£–†–û–ñ–ê–Ø ========== -->
        <div id="screen-harvest" class="screen">
            <!-- –ö–û–†–ó–ò–ù–ö–ò (–í–ò–î–ò–ú–´–ï) -->
            <img src="red1.png" class="basket" id="basket-red" data-color="red">
            <img src="orange1.png" class="basket" id="basket-orange" data-color="orange">
            <img src="brown1.png" class="basket" id="basket-brown" data-color="brown">
            <img src="purple1.png" class="basket" id="basket-purple" data-color="purple">
            <img src="beige1.png" class="basket" id="basket-beige" data-color="beige">
            <img src="green1.png" class="basket" id="basket-green" data-color="green">

            <!-- –ù–ï–í–ò–î–ò–ú–´–ï –ó–û–ù–´ –î–õ–Ø –ö–û–†–ó–ò–ù–û–ö (–¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è) -->
            <div class="basket-zone" id="basket-zone-red" style="left: 8%; top: 12%;" data-color="red"></div>
            <div class="basket-zone" id="basket-zone-orange" style="left: 25%; top: 12%;" data-color="orange"></div>
            <div class="basket-zone" id="basket-zone-brown" style="left: 42%; top: 12%;" data-color="brown"></div>
            <div class="basket-zone" id="basket-zone-purple" style="left: 59%; top: 12%;" data-color="purple"></div>
            <div class="basket-zone" id="basket-zone-beige" style="left: 76%; top: 12%;" data-color="beige"></div>
            <div class="basket-zone" id="basket-zone-green" style="left: 93%; top: 12%;" data-color="green"></div>

            <!-- –õ–£–ù–ö–ò –î–õ–Ø –û–í–û–©–ï–ô -->
            <div class="hole-zone" id="hole-1-harvest" style="left: 27%; top: 83.3%;" data-vegetable="tomato" data-screen="harvest"></div>
            <div class="hole-zone" id="hole-2-harvest" style="left: 48.5%; top: 83.3%;" data-vegetable="potato" data-screen="harvest"></div>
            <div class="hole-zone" id="hole-3-harvest" style="left: 68.8%; top: 83.3%;" data-vegetable="luk" data-screen="harvest"></div>
            <div class="hole-zone" id="hole-4-harvest" style="left: 34.8%; top: 66.8%;" data-vegetable="carrot" data-screen="harvest"></div>
            <div class="hole-zone" id="hole-5-harvest" style="left: 48.5%; top: 66.8%;" data-vegetable="buk" data-screen="harvest"></div>
            <div class="hole-zone" id="hole-6-harvest" style="left: 62.2%; top: 66.8%;" data-vegetable="ogr" data-screen="harvest"></div>

            <!-- –û–í–û–©–ò (–í –õ–£–ù–ö–ê–•) -->
            <img src="tomato.png" class="vegetable" id="veg-tomato" data-vegetable="tomato" data-color="red" style="left: 27%; top: 83.3%; transform: translate(-50%, -50%);">
            <img src="potato1.png" class="vegetable" id="veg-potato" data-vegetable="potato" data-color="brown" style="left: 48.5%; top: 83.3%; transform: translate(-50%, -50%);">
            <img src="luk.png" class="vegetable" id="veg-luk" data-vegetable="luk" data-color="beige" style="left: 68.8%; top: 83.3%; transform: translate(-50%, -50%);">
            <img src="carrot.png" class="vegetable" id="veg-carrot" data-vegetable="carrot" data-color="orange" style="left: 34.8%; top: 66.8%; transform: translate(-50%, -50%);">
            <img src="buk.png" class="vegetable" id="veg-buk" data-vegetable="buk" data-color="purple" style="left: 48.5%; top: 66.8%; transform: translate(-50%, -50%);">
            <img src="ogr.png" class="vegetable" id="veg-ogr" data-vegetable="ogr" data-color="green" style="left: 62.2%; top: 66.8%; transform: translate(-50%, -50%);">
        </div>

        <!-- –≠–ö–†–ê–ù –ü–û–ë–ï–î–´ -->
        <div id="win-screen">
            <div class="win-message">
                <h2>üéâ –£–†–ê! üéâ</h2>
                <p>–¢—ã —Å–æ–±—Ä–∞–ª –≤–µ—Å—å —É—Ä–æ–∂–∞–π!</p>
                <p style="font-size: 20px; margin-top: 15px;">–°—ã–≥—Ä–∞–µ–º –µ—â—ë?</p>
            </div>
            <button class="win-button" onclick="playAgain()">üåü –ï–©–Å –†–ê–ó üåü</button>
        </div>
    </div>

    <script>
        // ========== –û–ë–©–ò–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        const container = document.getElementById('game-container');
        const screenPlant = document.getElementById('screen-plant');
        const screenHarvest = document.getElementById('screen-harvest');
        const winScreen = document.getElementById('win-screen');
        const toHarvestBtn = document.getElementById('to-harvest-btn');

        let isDragging = false;
        let currentElement = null;
        let startX, startY, startLeft, startTop;
        let audioContext = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        function playSound(type) {
            try {
                initAudio();
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.connect(gain);
                gain.connect(audioContext.destination);

                if (type === 'correct') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(600, audioContext.currentTime);
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    osc.start();
                    osc.stop(audioContext.currentTime + 0.2);
                } else {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(200, audioContext.currentTime);
                    gain.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    osc.start();
                    osc.stop(audioContext.currentTime + 0.15);
                }
            } catch (e) {}
        }

        // ========== –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï ==========
        
        function onDragStart(e) {
            const element = e.target;
            
            if (!element.classList.contains('seed') && !element.classList.contains('vegetable')) return;
            if (element.classList.contains('placed')) return;
            if (winScreen.style.display === 'flex') return;
            
            e.preventDefault();
            initAudio();
            
            currentElement = element;
            isDragging = true;
            currentElement.classList.add('dragging');
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const rect = currentElement.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            startX = clientX - rect.left;
            startY = clientY - rect.top;
            
            startLeft = rect.left - containerRect.left;
            startTop = rect.top - containerRect.top;
            
            currentElement.style.left = startLeft + 'px';
            currentElement.style.top = startTop + 'px';
        }

        function onDragMove(e) {
            if (!isDragging || !currentElement) return;
            e.preventDefault();
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const containerRect = container.getBoundingClientRect();
            
            let newLeft = clientX - startX - containerRect.left;
            let newTop = clientY - startY - containerRect.top;
            
            const elementWidth = currentElement.offsetWidth;
            const elementHeight = currentElement.offsetHeight;
            
            newLeft = Math.max(0, Math.min(newLeft, containerRect.width - elementWidth));
            newTop = Math.max(0, Math.min(newTop, containerRect.height - elementHeight));
            
            currentElement.style.left = newLeft + 'px';
            currentElement.style.top = newTop + 'px';
        }

        function onDragEnd(e) {
            if (!isDragging || !currentElement) return;
            e.preventDefault();
            
            isDragging = false;
            currentElement.classList.remove('dragging');
            
            checkDrop(currentElement);
            currentElement = null;
        }

        // ========== –ü–†–û–í–ï–†–ö–ê ==========
        
        function checkDrop(element) {
            const elementRect = element.getBoundingClientRect();
            const elementCenterX = elementRect.left + elementRect.width / 2;
            const elementCenterY = elementRect.top + elementRect.height / 2;
            
            const currentScreen = element.closest('.screen').id;
            
            if (currentScreen === 'screen-plant') {
                // –ü–û–°–ê–î–ö–ê
                const seedColor = element.dataset.color;
                const holes = document.querySelectorAll('#screen-plant .hole-zone');
                
                for (let i = 0; i < holes.length; i++) {
                    const hole = holes[i];
                    const holeRect = hole.getBoundingClientRect();
                    
                    if (elementCenterX >= holeRect.left && elementCenterX <= holeRect.right &&
                        elementCenterY >= holeRect.top && elementCenterY <= holeRect.bottom) {
                        
                        const requiredColor = hole.dataset.seed;
                        
                        if (seedColor === requiredColor && !element.classList.contains('placed')) {
                            plantSeed(element, hole, i);
                            playSound('correct');
                        } else {
                            playSound('error');
                            returnToStart(element);
                            container.classList.add('shake');
                            setTimeout(() => container.classList.remove('shake'), 400);
                        }
                        return;
                    }
                }
                returnToStart(element);
                
            } else if (currentScreen === 'screen-harvest') {
                // –°–ë–û–† –£–†–û–ñ–ê–Ø - –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –∑–æ–Ω—ã –∫–æ—Ä–∑–∏–Ω–æ–∫
                const vegetableColor = element.dataset.color;
                const basketZones = document.querySelectorAll('#screen-harvest .basket-zone');
                
                for (let i = 0; i < basketZones.length; i++) {
                    const zone = basketZones[i];
                    const zoneRect = zone.getBoundingClientRect();
                    
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–æ–Ω—É –ø–æ–ø–∞–¥–∞–Ω–∏—è
                    const expandedRect = {
                        left: zoneRect.left - 20,
                        right: zoneRect.right + 20,
                        top: zoneRect.top - 20,
                        bottom: zoneRect.bottom + 20
                    };
                    
                    if (elementCenterX >= expandedRect.left && elementCenterX <= expandedRect.right &&
                        elementCenterY >= expandedRect.top && elementCenterY <= expandedRect.bottom) {
                        
                        const basketColor = zone.dataset.color;
                        
                        if (vegetableColor === basketColor && !element.classList.contains('placed')) {
                            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–æ—Ä–∑–∏–Ω–∫—É
                            const basket = document.querySelector(`.basket[data-color="${basketColor}"]`);
                            harvestVegetable(element, basket, i);
                            playSound('correct');
                        } else {
                            playSound('error');
                            returnVegetableToStart(element);
                            container.classList.add('shake');
                            setTimeout(() => container.classList.remove('shake'), 400);
                        }
                        return;
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–µ –ø–æ–ø–∞–ª –Ω–∏ –≤ –æ–¥–Ω—É –∑–æ–Ω—É –∫–æ—Ä–∑–∏–Ω–∫–∏
                returnVegetableToStart(element);
            }
        }

        // ========== –ü–û–°–ê–î–ö–ê ==========
        
        function plantSeed(seed, hole, holeIndex) {
            seed.classList.add('placed');
            
            const holeRect = hole.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const targetLeft = holeRect.left - containerRect.left + (holeRect.width / 2) - (seed.offsetWidth / 2);
            const targetTop = holeRect.top - containerRect.top + (holeRect.height / 2) - (seed.offsetHeight / 2);
            
            seed.style.left = targetLeft + 'px';
            seed.style.top = targetTop + 'px';
            
            checkAllPlanted();
        }

        function returnToStart(seed) {
            switch(seed.dataset.color) {
                case 'red': seed.style.left = '4%'; seed.style.top = '3%'; break;
                case 'orange': seed.style.left = '14%'; seed.style.top = '3%'; break;
                case 'brown': seed.style.left = '24%'; seed.style.top = '3%'; break;
                case 'purple': seed.style.left = '34%'; seed.style.top = '3%'; break;
                case 'beige': seed.style.left = '44%'; seed.style.top = '3%'; break;
                case 'green': seed.style.left = '54%'; seed.style.top = '3%'; break;
            }
        }

        function checkAllPlanted() {
            const seeds = document.querySelectorAll('#screen-plant .seed');
            const allPlanted = Array.from(seeds).every(seed => seed.classList.contains('placed'));
            
            if (allPlanted) {
                toHarvestBtn.classList.remove('hidden');
            }
        }

        // ========== –ü–ï–†–ï–•–û–î ==========
        
        function switchToHarvest() {
            screenPlant.style.display = 'none';
            screenHarvest.style.display = 'block';
        }

        // ========== –°–ë–û–† ==========
        
        function harvestVegetable(vegetable, basket, basketIndex) {
            vegetable.classList.add('placed');
            
            const basketRect = basket.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const targetLeft = basketRect.left - containerRect.left + (basketRect.width / 2) - (vegetable.offsetWidth / 2);
            const targetTop = basketRect.top - containerRect.top + (basketRect.height / 2) - (vegetable.offsetHeight / 2);
            
            vegetable.style.left = targetLeft + 'px';
            vegetable.style.top = targetTop + 'px';
            
            checkAllHarvested();
        }

        function returnVegetableToStart(vegetable) {
            switch(vegetable.dataset.vegetable) {
                case 'tomato':
                    vegetable.style.left = '27%';
                    vegetable.style.top = '83.3%';
                    break;
                case 'potato':
                    vegetable.style.left = '48.5%';
                    vegetable.style.top = '83.3%';
                    break;
                case 'luk':
                    vegetable.style.left = '68.8%';
                    vegetable.style.top = '83.3%';
                    break;
                case 'carrot':
                    vegetable.style.left = '34.8%';
                    vegetable.style.top = '66.8%';
                    break;
                case 'buk':
                    vegetable.style.left = '48.5%';
                    vegetable.style.top = '66.8%';
                    break;
                case 'ogr':
                    vegetable.style.left = '62.2%';
                    vegetable.style.top = '66.8%';
                    break;
            }
            vegetable.style.transform = 'translate(-50%, -50%)';
        }

        function checkAllHarvested() {
            const vegetables = document.querySelectorAll('#screen-harvest .vegetable');
            const allHarvested = Array.from(vegetables).every(veg => veg.classList.contains('placed'));
            
            if (allHarvested) {
                setTimeout(() => {
                    winScreen.style.display = 'flex';
                }, 500);
            }
        }

        // ========== –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê ==========
        
        function playAgain() {
            winScreen.style.display = 'none';
            screenHarvest.style.display = 'none';
            screenPlant.style.display = 'block';
            
            const seeds = document.querySelectorAll('#screen-plant .seed');
            seeds.forEach(seed => {
                seed.classList.remove('placed');
                returnToStart(seed);
            });
            
            const vegetables = document.querySelectorAll('#screen-harvest .vegetable');
            vegetables.forEach(veg => {
                veg.classList.remove('placed');
                returnVegetableToStart(veg);
            });
            
            toHarvestBtn.classList.add('hidden');
        }

        // ========== –°–û–ë–´–¢–ò–Ø ==========
        
        document.querySelectorAll('.seed, .vegetable').forEach(element => {
            element.addEventListener('mousedown', onDragStart);
            element.addEventListener('touchstart', onDragStart, { passive: false });
        });

        window.addEventListener('mousemove', onDragMove);
        window.addEventListener('touchmove', onDragMove, { passive: false });

        window.addEventListener('mouseup', onDragEnd);
        window.addEventListener('touchend', onDragEnd);

        document.addEventListener('selectstart', (e) => e.preventDefault());

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.switchToHarvest = switchToHarvest;
        window.playAgain = playAgain;

    </script>
</body>
</html>
