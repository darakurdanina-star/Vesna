<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–æ—Å–∞–¥–∏ —Å–µ–º–µ–Ω–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            touch-action: none;
            background-color: #2c3e50;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 57.14vw; /* 768/1344 = 0.5714, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ —Ñ–æ–Ω–∞ */
            max-width: 1344px;
            max-height: 768px;
            background-color: #4CAF50;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            margin: auto;
        }

        /* –§–û–ù –° –õ–£–ù–ö–ê–ú–ò */
        .background-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('fon.png');
            background-size: cover;
            background-position: center;
            z-index: 1;
        }

        /* –ö–ê–†–¢–ê –ü–û–°–ê–î–ö–ò */
        .map-container {
            position: absolute;
            top: 2%;
            right: 2%;
            width: 25%;
            max-width: 200px;
            aspect-ratio: 1/1;
            border: 4px solid white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            z-index: 10;
            background: white;
            pointer-events: none;
        }

        .map-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* –õ–£–ù–ö–ò (–Ω–µ–≤–∏–¥–∏–º—ã–µ –∑–æ–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏) */
        .hole-zone {
            position: absolute;
            width: 12%;  /* –†–∞–∑–º–µ—Ä –∑–æ–Ω—ã –≤–æ–∫—Ä—É–≥ –ª—É–Ω–∫–∏ */
            height: 12%;  /* –ß—Ç–æ–±—ã —Ä–µ–±—ë–Ω–∫—É –±—ã–ª–æ –ª–µ–≥—á–µ –ø–æ–ø–∞—Å—Ç—å */
            transform: translate(-50%, -50%); /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º */
            z-index: 5;
            /* border: 2px dashed red; /* –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ */
        }

        /* –°–ï–ú–ï–ù–ê */
        .seed {
            position: absolute;
            width: 8%;
            height: auto;
            cursor: grab;
            touch-action: none;
            user-select: none;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
            z-index: 20;
            transition: filter 0.2s;
        }

        .seed:active {
            cursor: grabbing;
            filter: drop-shadow(0 8px 6px rgba(0,0,0,0.5));
            transform: scale(1.05);
        }

        .seed.dragging {
            transition: none;
        }

        .seed.placed {
            cursor: default;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
            pointer-events: none; /* –ü–æ—Å–∞–∂–µ–Ω–Ω–æ–µ —Å–µ–º—è –±–æ–ª—å—à–µ –Ω–µ–ª—å–∑—è –¥–≤–∏–≥–∞—Ç—å */
        }

        /* –°–¢–ê–†–¢–û–í–´–ï –ü–û–ó–ò–¶–ò–ò –°–ï–ú–Ø–ù (–≤–Ω–∏–∑—É) */
        #seed-red { left: 10%; top: 90%; }
        #seed-orange { left: 25%; top: 90%; }
        #seed-brown { left: 40%; top: 90%; }
        #seed-purple { left: 55%; top: 90%; }
        #seed-beige { left: 70%; top: 90%; }
        #seed-green { left: 85%; top: 90%; }

        /* –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê (—É—Ä–æ–∂–∞–π) */
        #result-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .result-img {
            width: 80%;
            max-width: 500px;
            border: 5px solid white;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .next-button {
            padding: 15px 40px;
            font-size: 28px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #2E7D32;
            font-weight: bold;
        }

        .next-button:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #2E7D32;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ */
        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- –§–û–ù -->
        <div class="background-layer"></div>

        <!-- –ö–ê–†–¢–ê –ü–û–°–ê–î–ö–ò -->
        <div class="map-container">
            <img src="map.png" alt="–ö–∞—Ä—Ç–∞ –ø–æ—Å–∞–¥–∫–∏" class="map-img">
        </div>

        <!-- –ù–ï–í–ò–î–ò–ú–´–ï –ó–û–ù–´ –õ–£–ù–û–ö (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏—è) -->
        <!-- –õ—É–Ω–∫–∞ 1 (–Ω–∏–∂–Ω–∏–π —Ä—è–¥, –∫—Ä–∞—Å–Ω–æ–µ —Å–µ–º—è) -->
        <div class="hole-zone" id="hole-1" style="left: 27%; top: 83.3%;" data-seed="red"></div>
        <!-- –õ—É–Ω–∫–∞ 2 (–Ω–∏–∂–Ω–∏–π —Ä—è–¥, –∫–æ—Ä–∏—á–Ω–µ–≤–æ–µ) -->
        <div class="hole-zone" id="hole-2" style="left: 48.5%; top: 83.3%;" data-seed="brown"></div>
        <!-- –õ—É–Ω–∫–∞ 3 (–Ω–∏–∂–Ω–∏–π —Ä—è–¥, –±–µ–∂–µ–≤–æ–µ) -->
        <div class="hole-zone" id="hole-3" style="left: 68.8%; top: 83.3%;" data-seed="beige"></div>
        <!-- –õ—É–Ω–∫–∞ 4 (–≤–µ—Ä—Ö–Ω–∏–π —Ä—è–¥, –æ—Ä–∞–Ω–∂–µ–≤–æ–µ) -->
        <div class="hole-zone" id="hole-4" style="left: 34.8%; top: 66.8%;" data-seed="orange"></div>
        <!-- –õ—É–Ω–∫–∞ 5 (–≤–µ—Ä—Ö–Ω–∏–π —Ä—è–¥, —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–µ) -->
        <div class="hole-zone" id="hole-5" style="left: 48.5%; top: 66.8%;" data-seed="purple"></div>
        <!-- –õ—É–Ω–∫–∞ 6 (–≤–µ—Ä—Ö–Ω–∏–π —Ä—è–¥, –∑–µ–ª—ë–Ω–æ–µ) -->
        <div class="hole-zone" id="hole-6" style="left: 62.2%; top: 66.8%;" data-seed="green"></div>

        <!-- –°–ï–ú–ï–ù–ê (—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤–Ω–∏–∑—É) -->
        <img src="red.png" class="seed" id="seed-red" data-color="red">
        <img src="orange.png" class="seed" id="seed-orange" data-color="orange">
        <img src="brown.png" class="seed" id="seed-brown" data-color="brown">
        <img src="purple.png" class="seed" id="seed-purple" data-color="purple">
        <img src="beige.png" class="seed" id="seed-beige" data-color="beige">
        <img src="green.png" class="seed" id="seed-green" data-color="green">

        <!-- –≠–ö–†–ê–ù –° –†–ï–ó–£–õ–¨–¢–ê–¢–û–ú (—É—Ä–æ–∂–∞–π) -->
        <div id="result-screen">
            <img src="result.png" alt="–£—Ä–æ–∂–∞–π –≤—ã—Ä–æ—Å!" class="result-img">
            <button class="next-button" onclick="goToHarvest()">üå± –ù–ê –°–ë–û–† –£–†–û–ñ–ê–Ø üå±</button>
        </div>
    </div>

    <script>
        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–µ–º–µ–Ω–∞ –∏ –∑–æ–Ω—ã –ª—É–Ω–æ–∫
        const seeds = document.querySelectorAll('.seed');
        const holes = document.querySelectorAll('.hole-zone');
        const resultScreen = document.getElementById('result-screen');
        const container = document.getElementById('game-container');

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã: –∫–∞–∫–∏–µ –ª—É–Ω–∫–∏ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
        const filledHoles = new Array(holes.length).fill(false);
        
        // –¢–µ–∫—É—â–µ–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
        let isDragging = false;
        let currentSeed = null;
        let startX, startY, startLeft, startTop;

        // –ó–≤—É–∫–∏ (–ø—Ä–æ—Å—Ç—ã–µ)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.2);
            } else {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.15);
            }
        }

        // ========== –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï ==========
        
        function onDragStart(e) {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º, –µ—Å–ª–∏ —Å–µ–º—è —É–∂–µ –ø–æ—Å–∞–∂–µ–Ω–æ
            if (e.target.classList.contains('placed')) return;
            
            e.preventDefault();
            currentSeed = e.target;
            
            // –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω ‚Äî –Ω–µ –¥–∞—ë–º –¥–≤–∏–≥–∞—Ç—å
            if (resultScreen.style.display === 'flex') return;
            
            isDragging = true;
            currentSeed.classList.add('dragging');
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const rect = currentSeed.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            startX = clientX - rect.left;
            startY = clientY - rect.top;
            
            startLeft = rect.left - containerRect.left;
            startTop = rect.top - containerRect.top;
            
            // –£–±–∏—Ä–∞–µ–º transform –¥–ª—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
            currentSeed.style.transform = 'none';
            currentSeed.style.left = startLeft + 'px';
            currentSeed.style.top = startTop + 'px';
        }

        function onDragMove(e) {
            if (!isDragging || !currentSeed) return;
            e.preventDefault();
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const containerRect = container.getBoundingClientRect();
            
            let newLeft = clientX - startX - containerRect.left;
            let newTop = clientY - startY - containerRect.top;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            const seedWidth = currentSeed.offsetWidth;
            const seedHeight = currentSeed.offsetHeight;
            
            newLeft = Math.max(0, Math.min(newLeft, containerRect.width - seedWidth));
            newTop = Math.max(0, Math.min(newTop, containerRect.height - seedHeight));
            
            currentSeed.style.left = newLeft + 'px';
            currentSeed.style.top = newTop + 'px';
        }

        function onDragEnd(e) {
            if (!isDragging || !currentSeed) return;
            e.preventDefault();
            
            isDragging = false;
            currentSeed.classList.remove('dragging');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫—É–¥–∞ –æ—Ç–ø—É—Å—Ç–∏–ª–∏ —Å–µ–º—è
            checkDrop(currentSeed);
            currentSeed = null;
        }

        // ========== –ü–†–û–í–ï–†–ö–ê –ü–û–ü–ê–î–ê–ù–ò–Ø ==========
        
        function checkDrop(seed) {
            const seedRect = seed.getBoundingClientRect();
            const seedCenterX = seedRect.left + seedRect.width / 2;
            const seedCenterY = seedRect.top + seedRect.height / 2;
            
            const seedColor = seed.dataset.color;
            
            // –ò—â–µ–º –ª—É–Ω–∫—É, –≤ –∫–æ—Ç–æ—Ä—É—é –ø–æ–ø–∞–ª —Ü–µ–Ω—Ç—Ä —Å–µ–º–µ–Ω–∏
            for (let i = 0; i < holes.length; i++) {
                const hole = holes[i];
                const holeRect = hole.getBoundingClientRect();
                
                if (seedCenterX >= holeRect.left && seedCenterX <= holeRect.right &&
                    seedCenterY >= holeRect.top && seedCenterY <= holeRect.bottom) {
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ —Å–µ–º—è –¥–ª—è —ç—Ç–æ–π –ª—É–Ω–∫–∏
                    const requiredColor = hole.dataset.seed;
                    
                    if (seedColor === requiredColor && !filledHoles[i]) {
                        // –ü–†–ê–í–ò–õ–¨–ù–û! –°–µ–º—è —Å–∞–∂–∞–µ–º –≤ –ª—É–Ω–∫—É
                        plantSeed(seed, hole, i);
                        playSound('correct');
                    } else {
                        // –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: —Å–µ–º—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç
                        playSound('error');
                        returnSeedToStart(seed);
                        // –¢—Ä—è—Å—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                        container.classList.add('shake');
                        setTimeout(() => container.classList.remove('shake'), 400);
                    }
                    return;
                }
            }
            
            // –ï—Å–ª–∏ –æ—Ç–ø—É—Å—Ç–∏–ª–∏ –Ω–µ –Ω–∞–¥ –ª—É–Ω–∫–æ–π ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ —Å—Ç–∞—Ä—Ç
            returnSeedToStart(seed);
        }

        // –ü–æ—Å–∞–¥–∫–∞ —Å–µ–º–µ–Ω–∏ –≤ –ª—É–Ω–∫—É
        function plantSeed(seed, hole, holeIndex) {
            // –ü–æ–º–µ—á–∞–µ–º –ª—É–Ω–∫—É –∫–∞–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—É—é
            filledHoles[holeIndex] = true;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–º–µ–Ω–∏ –∫–ª–∞—Å—Å "–ø–æ—Å–∞–∂–µ–Ω–æ"
            seed.classList.add('placed');
            
            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Å–µ–º—è –≤ —Ü–µ–Ω—Ç—Ä –ª—É–Ω–∫–∏
            const holeRect = hole.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const targetLeft = holeRect.left - containerRect.left + (holeRect.width / 2) - (seed.offsetWidth / 2);
            const targetTop = holeRect.top - containerRect.top + (holeRect.height / 2) - (seed.offsetHeight / 2);
            
            seed.style.left = targetLeft + 'px';
            seed.style.top = targetTop + 'px';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –ª—É–Ω–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
            checkAllPlanted();
        }

        // –í–æ–∑–≤—Ä–∞—Ç —Å–µ–º–µ–Ω–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
        function returnSeedToStart(seed) {
            const seedId = seed.id;
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ü–≤–µ—Ç–∞
            switch(seed.dataset.color) {
                case 'red': seed.style.left = '10%'; seed.style.top = '90%'; break;
                case 'orange': seed.style.left = '25%'; seed.style.top = '90%'; break;
                case 'brown': seed.style.left = '40%'; seed.style.top = '90%'; break;
                case 'purple': seed.style.left = '55%'; seed.style.top = '90%'; break;
                case 'beige': seed.style.left = '70%'; seed.style.top = '90%'; break;
                case 'green': seed.style.left = '85%'; seed.style.top = '90%'; break;
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º transform –Ω–∞ –º–µ—Å—Ç–æ
            seed.style.transform = 'translate(0, 0)';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤—Å–µ –ª–∏ —Å–µ–º–µ–Ω–∞ –ø–æ—Å–∞–∂–µ–Ω—ã
        function checkAllPlanted() {
            const allPlanted = Array.from(seeds).every(seed => seed.classList.contains('placed'));
            
            if (allPlanted) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—É—Ä–æ–∂–∞–π)
                setTimeout(() => {
                    resultScreen.style.display = 'flex';
                }, 500);
            }
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –∫–æ –≤—Ç–æ—Ä–æ–º—É —ç–∫—Ä–∞–Ω—É (—Å–±–æ—Ä —É—Ä–æ–∂–∞—è)
        function goToHarvest() {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—Ç–æ—Ä–æ–π —ç–∫—Ä–∞–Ω
            alert('–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–±–æ—Ä —É—Ä–æ–∂–∞—è!');
            // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏: window.location.href = 'harvest.html';
        }

        // ========== –ù–ê–ó–ù–ê–ß–ê–ï–ú –°–û–ë–´–¢–ò–Ø ==========
        
        seeds.forEach(seed => {
            seed.addEventListener('mousedown', onDragStart);
            seed.addEventListener('touchstart', onDragStart, { passive: false });
        });

        window.addEventListener('mousemove', onDragMove);
        window.addEventListener('touchmove', onDragMove, { passive: false });

        window.addEventListener('mouseup', onDragEnd);
        window.addEventListener('touchend', onDragEnd);

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –∫–ª–∏–∫–∞—Ö
        document.addEventListener('selectstart', (e) => e.preventDefault());

    </script>
</body>
</html>
